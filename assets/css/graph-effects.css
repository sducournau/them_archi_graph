/* ================================================
   GRAPH NODE VISUAL EFFECTS
   Enhanced interactions and states
   Cross-browser compatible version
   üî• Utilise les variables CSS du Customizer WordPress
   ================================================ */

/* Node States */
.graph-node {
  -webkit-transition: all var(--archi-hover-transition, 300ms) ease;
  -moz-transition: all var(--archi-hover-transition, 300ms) ease;
  -o-transition: all var(--archi-hover-transition, 300ms) ease;
  transition: all var(--archi-hover-transition, 300ms) ease;
}

.graph-node.node-inactive {
  opacity: 0.5;
  -webkit-filter: grayscale(30%);
  filter: grayscale(30%);
}

.graph-node.node-active {
  opacity: 1;
  -webkit-filter: none;
  filter: none;
}

/* Node Circle Enhancements */
.node-circle {
  -webkit-transition: all var(--archi-hover-transition, 300ms) cubic-bezier(0.4, 0, 0.2, 1);
  -moz-transition: all var(--archi-hover-transition, 300ms) cubic-bezier(0.4, 0, 0.2, 1);
  -o-transition: all var(--archi-hover-transition, 300ms) cubic-bezier(0.4, 0, 0.2, 1);
  transition: all var(--archi-hover-transition, 300ms) cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
  /* üî• Effet de profondeur avec ombre port√©e param√©trable */
  -webkit-filter: drop-shadow(0 2px var(--archi-shadow-blur, 6px) rgba(0, 0, 0, var(--archi-shadow-opacity, 0.3)));
  filter: drop-shadow(0 2px var(--archi-shadow-blur, 6px) rgba(0, 0, 0, var(--archi-shadow-opacity, 0.3)));
}

.node-circle:hover {
  /* üî• Luminosit√© et lueur param√©trables au survol */
  -webkit-filter: brightness(var(--archi-hover-brightness, 1.15)) 
                  drop-shadow(0 4px 12px rgba(0, 0, 0, var(--archi-shadow-opacity, 0.3))) 
                  drop-shadow(0 0 var(--archi-active-glow-intensity, 20px) currentColor);
  filter: brightness(var(--archi-hover-brightness, 1.15)) 
          drop-shadow(0 4px 12px rgba(0, 0, 0, var(--archi-shadow-opacity, 0.3))) 
          drop-shadow(0 0 var(--archi-active-glow-intensity, 20px) currentColor);
  -webkit-transform: scale(var(--archi-hover-scale, 1.2));
  -moz-transform: scale(var(--archi-hover-scale, 1.2));
  -ms-transform: scale(var(--archi-hover-scale, 1.2));
  transform: scale(var(--archi-hover-scale, 1.2));
}

/* Halo Effect */
.node-halo {
  -webkit-transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  -moz-transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  -o-transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  pointer-events: none;
  opacity: 0.4;
  stroke-width: 2;
  /* Effet de halo lumineux */
  -webkit-filter: blur(2px);
  filter: blur(2px);
}

.graph-node:hover .node-halo {
  /* üî• Opacit√© de lueur param√©trable */
  opacity: var(--archi-active-glow-opacity, 0.8);
  stroke-width: 3;
  -webkit-filter: blur(var(--archi-active-glow-blur, 3px));
  filter: blur(var(--archi-active-glow-blur, 3px));
  -webkit-animation: halo-expand 1.5s ease-in-out infinite;
  -moz-animation: halo-expand 1.5s ease-in-out infinite;
  animation: halo-expand 1.5s ease-in-out infinite;
}

@-webkit-keyframes halo-expand {
  0%, 100% { 
    -webkit-transform: scale(1);
    transform: scale(1);
    opacity: var(--archi-active-glow-opacity, 0.8); 
  }
  50% { 
    -webkit-transform: scale(1.15);
    transform: scale(1.15);
    opacity: calc(var(--archi-active-glow-opacity, 0.8) * 0.625); /* 50% de l'opacit√© */ 
  }
}

@-moz-keyframes halo-expand {
  0%, 100% { 
    -moz-transform: scale(1);
    transform: scale(1);
    opacity: var(--archi-active-glow-opacity, 0.8); 
  }
  50% { 
    -moz-transform: scale(1.15);
    transform: scale(1.15);
    opacity: calc(var(--archi-active-glow-opacity, 0.8) * 0.625); 
  }
}

@keyframes halo-expand {
  0%, 100% { 
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
    opacity: var(--archi-active-glow-opacity, 0.8); 
  }
  50% { 
    -webkit-transform: scale(1.15);
    -moz-transform: scale(1.15);
    -ms-transform: scale(1.15);
    transform: scale(1.15);
    opacity: calc(var(--archi-active-glow-opacity, 0.8) * 0.625); 
  }
}

/* Shine Effect */
.node-shine {
  -webkit-transition: opacity var(--archi-hover-transition, 300ms) ease;
  -moz-transition: opacity var(--archi-hover-transition, 300ms) ease;
  -o-transition: opacity var(--archi-hover-transition, 300ms) ease;
  transition: opacity var(--archi-hover-transition, 300ms) ease;
  pointer-events: none;
  opacity: 0.3;
  /* Brillance radiale */
  fill: url(#radial-shine-gradient);
  mix-blend-mode: screen;
}

.graph-node:hover .node-shine {
  opacity: 0.6;
  -webkit-animation: shine-pulse var(--archi-pulse-duration, 2500ms) ease-in-out infinite;
  -moz-animation: shine-pulse var(--archi-pulse-duration, 2500ms) ease-in-out infinite;
  animation: shine-pulse var(--archi-pulse-duration, 2500ms) ease-in-out infinite;
}

@-webkit-keyframes shine-pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 0.9; }
}

@-moz-keyframes shine-pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 0.9; }
}

@keyframes shine-pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 0.9; }
}

/* Label Enhancements */
.node-label {
  -webkit-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  -moz-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  -o-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  pointer-events: none;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Am√©lioration de la lisibilit√© */
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 8px rgba(255, 255, 255, 0.5);
  letter-spacing: 0.3px;
}

.graph-node:hover .node-label {
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4), 0 0 12px rgba(255, 255, 255, 0.8);
  -webkit-transform: scale(1.05);
  -moz-transform: scale(1.05);
  -ms-transform: scale(1.05);
  transform: scale(1.05);
}

/* Shockwave Effect (temporary) */
.node-shockwave {
  pointer-events: none;
  -webkit-animation: shockwave 0.6s ease-out forwards;
  -moz-animation: shockwave 0.6s ease-out forwards;
  animation: shockwave 0.6s ease-out forwards;
}

@-webkit-keyframes shockwave {
  0% {
    r: 30;
    stroke-opacity: 0.8;
  }
  100% {
    r: 90;
    stroke-opacity: 0;
  }
}

@-moz-keyframes shockwave {
  0% {
    r: 30;
    stroke-opacity: 0.8;
  }
  100% {
    r: 90;
    stroke-opacity: 0;
  }
}

@keyframes shockwave {
  0% {
    r: 30;
    stroke-opacity: 0.8;
  }
  100% {
    r: 90;
    stroke-opacity: 0;
  }
}

/* Pulse Animation for Active Nodes */
@-webkit-keyframes node-pulse {
  0%, 100% {
    -webkit-transform: scale(1);
    transform: scale(1);
    opacity: 1;
  }
  50% {
    -webkit-transform: scale(1.05);
    transform: scale(1.05);
    opacity: 0.9;
  }
}

@-moz-keyframes node-pulse {
  0%, 100% {
    -moz-transform: scale(1);
    transform: scale(1);
    opacity: 1;
  }
  50% {
    -moz-transform: scale(1.05);
    transform: scale(1.05);
    opacity: 0.9;
  }
}

@keyframes node-pulse {
  0%, 100% {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
    opacity: 1;
  }
  50% {
    -webkit-transform: scale(1.08);
    -moz-transform: scale(1.08);
    -ms-transform: scale(1.08);
    transform: scale(1.08);
    opacity: 0.85;
  }
}

.node-pulse-active .node-circle {
  -webkit-animation: node-pulse 2.5s cubic-bezier(0.45, 0, 0.55, 1) infinite;
  -moz-animation: node-pulse 2.5s cubic-bezier(0.45, 0, 0.55, 1) infinite;
  animation: node-pulse 2.5s cubic-bezier(0.45, 0, 0.55, 1) infinite;
}

/* Glow Effect Enhancement */
.node-glow {
  filter: drop-shadow(0 0 8px currentColor);
}

/* Breathing Animation for Inactive Nodes */
@-webkit-keyframes node-breathe {
  0%, 100% {
    opacity: 0.4;
  }
  50% {
    opacity: 0.3;
  }
}

@-moz-keyframes node-breathe {
  0%, 100% {
    opacity: 0.4;
  }
  50% {
    opacity: 0.3;
  }
}

@keyframes node-breathe {
  0%, 100% {
    opacity: 0.4;
  }
  50% {
    opacity: 0.3;
  }
}

.node-inactive .node-circle {
  -webkit-animation: node-breathe 3s ease-in-out infinite;
  -moz-animation: node-breathe 3s ease-in-out infinite;
  animation: node-breathe 3s ease-in-out infinite;
}

/* Hover State Enhancements */
.graph-node:hover .node-circle {
  stroke-width: 3;
  -webkit-filter: brightness(1.15) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.25)) drop-shadow(0 0 20px currentColor);
  filter: brightness(1.15) drop-shadow(0 4px 12px rgba(0, 0, 0, 0.25)) drop-shadow(0 0 20px currentColor);
  -webkit-transform: scale(1.08);
  -moz-transform: scale(1.08);
  -ms-transform: scale(1.08);
  transform: scale(1.08);
}

.graph-node:hover .node-label {
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4), 0 0 12px rgba(255, 255, 255, 0.8);
  -webkit-transform: scale(1.05);
  -moz-transform: scale(1.05);
  -ms-transform: scale(1.05);
  transform: scale(1.05);
}

/* Click/Active State */
.graph-node:active .node-circle {
  -webkit-transform: scale(0.95);
  -moz-transform: scale(0.95);
  -ms-transform: scale(0.95);
  transform: scale(0.95);
  -webkit-transition: transform 0.05s ease;
  -moz-transition: transform 0.05s ease;
  -o-transition: transform 0.05s ease;
  transition: transform 0.05s ease;
}

/* Focus State for Accessibility */
.graph-node:focus {
  outline: 2px solid #4CAF50;
  outline-offset: 4px;
  border-radius: 50%;
}

/* Featured/Priority Nodes */
.graph-node.node-featured .node-circle {
  stroke-width: 4;
  stroke: #FFD700;
  -webkit-filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.5));
  filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.5));
}

.graph-node.node-featured .node-halo {
  stroke: #FFD700;
  stroke-width: 2;
  stroke-opacity: 0.3;
  -webkit-animation: halo-pulse 2s ease-in-out infinite;
  -moz-animation: halo-pulse 2s ease-in-out infinite;
  animation: halo-pulse 2s ease-in-out infinite;
}

@-webkit-keyframes halo-pulse {
  0%, 100% {
    r: 34;
    stroke-opacity: 0.3;
  }
  50% {
    r: 38;
    stroke-opacity: 0.5;
  }
}

@-moz-keyframes halo-pulse {
  0%, 100% {
    r: 34;
    stroke-opacity: 0.3;
  }
  50% {
    r: 38;
    stroke-opacity: 0.5;
  }
}

@keyframes halo-pulse {
  0%, 100% {
    r: 34;
    stroke-opacity: 0.3;
  }
  50% {
    r: 38;
    stroke-opacity: 0.5;
  }
}

/* Connection Highlight on Hover */
.graph-link {
  -webkit-transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  -moz-transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  -o-transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  stroke-opacity: 0.3;
  /* Am√©lioration visuelle des liens */
  stroke-linecap: round;
  -webkit-filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.1));
  filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.1));
}

.graph-node:hover ~ .graph-link {
  stroke-opacity: 0.15;
}

.graph-link.connected-to-hover {
  stroke-opacity: 1 !important;
  stroke-width: 3;
  stroke: #4CAF50;
  -webkit-filter: drop-shadow(0 0 6px #4CAF50) drop-shadow(0 0 12px rgba(76, 175, 80, 0.4));
  filter: drop-shadow(0 0 6px #4CAF50) drop-shadow(0 0 12px rgba(76, 175, 80, 0.4));
  -webkit-animation: link-pulse 1.5s cubic-bezier(0.45, 0, 0.55, 1) infinite;
  -moz-animation: link-pulse 1.5s cubic-bezier(0.45, 0, 0.55, 1) infinite;
  animation: link-pulse 1.5s cubic-bezier(0.45, 0, 0.55, 1) infinite;
}

@-webkit-keyframes link-pulse {
  0%, 100% {
    stroke-opacity: 1;
    stroke-width: 3;
  }
  50% {
    stroke-opacity: 0.6;
    stroke-width: 3.5;
  }
}

@-moz-keyframes link-pulse {
  0%, 100% {
    stroke-opacity: 1;
    stroke-width: 3;
  }
  50% {
    stroke-opacity: 0.6;
    stroke-width: 3.5;
  }
}

@keyframes link-pulse {
  0%, 100% {
    stroke-opacity: 1;
    stroke-width: 3;
  }
  50% {
    stroke-opacity: 0.6;
    stroke-width: 3.5;
  }
}

/* Loading State */
.graph-node.node-loading .node-circle {
  -webkit-animation: node-loading 1.5s linear infinite;
  -moz-animation: node-loading 1.5s linear infinite;
  animation: node-loading 1.5s linear infinite;
}

@-webkit-keyframes node-loading {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@-moz-keyframes node-loading {
  0% {
    -moz-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -moz-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes node-loading {
  0% {
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

/* Error State */
.graph-node.node-error .node-circle {
  fill: #f44336;
  stroke: #d32f2f;
  -webkit-animation: node-shake 0.5s ease-in-out;
  -moz-animation: node-shake 0.5s ease-in-out;
  animation: node-shake 0.5s ease-in-out;
}

@-webkit-keyframes node-shake {
  0%, 100% {
    -webkit-transform: translateX(0);
    transform: translateX(0);
  }
  25% {
    -webkit-transform: translateX(-5px);
    transform: translateX(-5px);
  }
  75% {
    -webkit-transform: translateX(5px);
    transform: translateX(5px);
  }
}

@-moz-keyframes node-shake {
  0%, 100% {
    -moz-transform: translateX(0);
    transform: translateX(0);
  }
  25% {
    -moz-transform: translateX(-5px);
    transform: translateX(-5px);
  }
  75% {
    -moz-transform: translateX(5px);
    transform: translateX(5px);
  }
}

@keyframes node-shake {
  0%, 100% {
    -webkit-transform: translateX(0);
    -moz-transform: translateX(0);
    -ms-transform: translateX(0);
    transform: translateX(0);
  }
  25% {
    -webkit-transform: translateX(-5px);
    -moz-transform: translateX(-5px);
    -ms-transform: translateX(-5px);
    transform: translateX(-5px);
  }
  75% {
    -webkit-transform: translateX(5px);
    -moz-transform: translateX(5px);
    -ms-transform: translateX(5px);
    transform: translateX(5px);
  }
}

/* Drag State */
.graph-node.dragging {
  cursor: grabbing !important;
  cursor: -webkit-grabbing !important;
  cursor: -moz-grabbing !important;
  z-index: 1000;
}

.graph-node.dragging .node-circle {
  stroke-width: 4;
  -webkit-filter: brightness(1.25) drop-shadow(0 6px 20px rgba(0, 0, 0, 0.35)) drop-shadow(0 0 30px currentColor);
  filter: brightness(1.25) drop-shadow(0 6px 20px rgba(0, 0, 0, 0.35)) drop-shadow(0 0 30px currentColor);
  -webkit-transform: scale(1.12);
  -moz-transform: scale(1.12);
  -ms-transform: scale(1.12);
  transform: scale(1.12);
}

.graph-node.dragging .node-label {
  font-weight: 800;
  -webkit-transform: scale(1.1);
  -moz-transform: scale(1.1);
  -ms-transform: scale(1.1);
  transform: scale(1.1);
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .node-label {
    font-size: 10px;
  }
  
  .graph-node:hover .node-circle {
    stroke-width: 2;
  }
}

/* Print Styles */
@media print {
  .node-halo,
  .node-shine {
    display: none;
  }
  
  .graph-node {
    filter: none !important;
  }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
  .node-circle {
    stroke-width: 3;
  }
  
  .node-label {
    font-weight: 600;
    text-shadow: 0 0 2px white;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .graph-node,
  .node-circle,
  .node-halo,
  .node-shine,
  .node-label {
    animation: none !important;
    transition: none !important;
  }
}
